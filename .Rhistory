runApp()
runApp()
runApp()
?PrimaryButton.shinyInput
runApp()
runApp()
runApp()
?validate
init_fasta <- ">H
EVQLVESGGGLVQPGGSLRLSCAASGFNIKDTYIHWVRQAPGKGLEWVARIYPTNGYTRYADSVKGRFTISADTSKNTAYLQMNSLRAEDTAVYYCSRWGGDGFYAMDYWGQGTLVTVSS
>L
DIQMTQSPSSLSASVGDRVTITCRASQDVNTAVAWYQQKPGKAPKLLIYSASFLYSGVPSRFSGSRSGTDFTLTISSLQPEDFATYYCQQHYTTPPTFGQGTKVEIK
>A
CHPECFGPEADQCVACAHYKDPPFCVARCPSIWKFPDEEGACQPCPIN"
aaseq <- init_fasta
aaseq
gsub(">[A-Z]","",aaseq)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.)
library(dplyr)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n")[[1]]
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n")
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n") %>% `[[`(1)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n") %>% `[[`(1) %>% `[`(2,3,4)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n") %>% `[[`(1) %>% `[`(2)
gsub(">[A-Z]","",aaseq) %>% paste0("\n",.) %>% strsplit(.,"\n\n") %>% `[[`(1) %>% `[`(2:4)
run_anno <- function(seq){
temp_file <- paste0("/data/sdd/wt/antibody_design/tmp/anno_test",".fa")
seqinr::write.fasta(seq,names = "test",file.out = temp_file)
commd <- paste0("/home/wt/Antigen_design/scripts/AbRSA/AbRSA -i ", temp_file,
" -o /data/sdd/wt/antibody_design/tmp/anno_test",
" > /data/sdd/wt/antibody_design/tmp/anno_test",".out")
system(commd)
out <- tryCatch({
data.table::fread(paste0("/data/sdd/wt/antibody_design/tmp/anno_test",".out"),
skip = "#similarity",
data.table = F,sep = ":",header = F)
},error = function(e){
NA
})
return(out)
}
hano <- run_anno[1]
hano <- run_anno(hla[0])
##输入的是H L A
hla <- gsub(">[A-Z]","",aaseq) %>%
paste0("\n",.) %>% strsplit(.,"\n\n") %>%
`[[`(1) %>% `[`(2:4)
hla[0]
hla
hano <- run_anno(hla[1])
lano <- run_anno(hla[2])
run_anno <- function(seq){
temp_file <- paste0("/data/sdd/wt/antibody_design/tmp/anno_test",".fa")
seqinr::write.fasta(seq,names = "test",file.out = temp_file)
commd <- paste0("/home/wt/Antigen_design/scripts/AbRSA/AbRSA -i ", temp_file,
" -o /data/sdd/wt/antibody_design/tmp/anno_test",
" > /data/sdd/wt/antibody_design/tmp/anno_test",".out")
system(commd)
out <- tryCatch({
data.table::fread(paste0("/data/sdd/wt/antibody_design/tmp/anno_test",".out"),
skip = "#similarity",
data.table = F,sep = ":",header = F)
},error = function(e){
NA
})
return(out)
}
hano <- run_anno(hla[1])
lano <- run_anno(hla[2])
View(hano)
View(hano)
("H_CDR3" %in% hano$V1) & ("L_CDR3" %in% lano)
View(lano)
("H_CDR3" %in% hano$V1) & ("L_CDR3" %in% lano$V1)
nrow
nrow(hano)
(nrow(hano) >= 7) & (nrow(lano) >= 7)
check_ab <- function(aaseq){
##输入的是H L A
hla <- gsub(">[A-Z]","",aaseq) %>%
paste0("\n",.) %>% strsplit(.,"\n\n") %>%
`[[`(1) %>% `[`(2:4)
hano <- run_anno(hla[1])
lano <- run_anno(hla[2])
if ((nrow(hano) >= 7) & (nrow(lano) >= 7)){
return("yes")
}
}
runApp()
runApp()
?shinyFeedback::feedbackDanger
runApp()
check_ab(init_fasta) == "yes"
runApp()
aa <- check_ab(init_fasta) == "yes"
shiny::isTruthy(aa)
runApp()
runApp()
runApp()
runApp()
/textOutput
？textOutput
?textOutput
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
check_ab <- function(aaseq){
##输入的是H L A
hla <- gsub(">[A-Z]","",aaseq) %>%
paste0("\n",.) %>% strsplit(.,"\n\n") %>%
`[[`(1) %>% `[`(2:4)
hano <- run_anno(hla[1])
lano <- run_anno(hla[2])
if ((nrow(hano) >= 7) & (nrow(lano) >= 7)){
return("yes")
}else{
return("no")
}
}
runApp()
runApp()
list(hla)
as.list(hla)
as.numeric(Sys.time())
paste0("/home/ab/run/run_test/tmp_",
as.numeric(Sys.time()),".fasta")
as.numeric(Sys.time())
paste0("/home/ab/run/run_test/tmp_",
as.character(as.numeric(Sys.time())),".fasta")
as.numeric(Sys.time())
as.character(as.numeric(Sys.time()))
Sys.time()
as.character(Sys.time())
as.numeric(Sys.time())
as.numeric(Sys.time()) %>% as.character()
?Sys.time
input_seq_data$fasta_path <- paste0("/home/ab/run/run_test/tmp_",
as.character(as.numeric(Sys.time())) %>% gsub("[.]+","",.),
".fasta")
paste0("/home/ab/run/run_test/tmp_",
as.character(as.numeric(Sys.time())) %>% gsub("[.]+","",.),
".fasta")
fasta_name <- paste0(as.character(as.numeric(Sys.time())) %>% gsub("[.]+","",.),
".fasta")
fasta_name
seqinr::write.fasta(as.list(hla),c("H","L","A"),
paste0("~/Ab_Design/test/",fasta_name))
library(RcppTOML)
tomledit::toml(list(aa="t"))
runApp()
runApp()
?TRUE
as.logical("TRUE")
runApp()
runApp()
runApp()
runApp()
?card
runApp()
runApp()
runApp()
runApp()
runApp()
?textAreaInput
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
tmp_file_pre = "tt"
paste0('docker exec --user ab abdesigner_last /bin/bash -c "source /home/ab/miniconda3/bin/activate; python /home/ab/run/run_seq.py -c ',
'/home/ab/run/run_test/tmp_seq_',tmp_file_pre,'.toml"')
paste0('docker exec --user ab abdesigner_last /bin/bash -c "source /home/ab/miniconda3/bin/activate; python /home/ab/run/run_seq.py -c ',
'/home/ab/run/run_test/tmp_seq_',tmp_file_pre,'.toml"') %>% print()
paste0("docker exec --user ab abdesigner_last /bin/bash -c 'source /home/ab/miniconda3/bin/activate; python /home/ab/run/run_seq.py -c ",
"/home/ab/run/run_test/tmp_seq_",tmp_file_pre,".toml'")
runApp()
runApp()
shiny::runApp()
runApp()
?NGLVieweR
runApp()
library(NGLVieweR)
library(NGLVieweR)
runApp()
shiny::runApp()
?renderNGLVieweR
system(paste0("mkdir /home/wt/Ab_Design/test/output/lgfold;",
"unzip /home/wt/Ab_Design/test/output/lgfold_pdb_",tmp_file_pre,
".zip -d /home/wt/Ab_Design/test/output/lgfold"))
tmp_file_pre = "1754638016874"
system(paste0("mkdir /home/wt/Ab_Design/test/output/lgfold;",
"unzip /home/wt/Ab_Design/test/output/lgfold_pdb_",tmp_file_pre,
".zip -d /home/wt/Ab_Design/test/output/lgfold"))
system(paste0("mkdir /home/wt/Ab_Design/test/output/docking;",
"unzip /home/wt/Ab_Design/test/output/docking_res",
".zip -d /home/wt/Ab_Design/test/output/docking"))
system(paste0("mkdir /home/wt/Ab_Design/test/output/tfold;",
"unzip /home/wt/Ab_Design/test/output/tfold_pdb_",tmp_file_pre,
".zip -d /home/wt/Ab_Design/test/output/tfold"))
pdb_path <- paste0("/home/wt/Ab_Design/test/output/docking/",
input$pre_struc_id_which,"/",input$pre_struc_id_which,
"_rank_1_unrelaxed.pdb")
###清空output
system("rm -rf /home/wt/Ab_Design/test/output/*")
runApp()
runApp()
runApp()
runApp()
runApp()
?selectInput
runApp()
runApp()
runApp()
runApp()
runApp()
dir.exists("/home/wt/Ab_Design/test/output/lgfold")
exists("/home/wt/Ab_Design/test/output/docking")
dir.exists("/home/wt/Ab_Design/test/output/tfold")
runApp()
runApp()
runApp()
runApp()
NGLVieweR("/home/wt/Ab_Design/test/output/lgfold/IgLM_seq_0.pdb") %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(name = "cartoon", colorScheme = "residueindex")
)
?NGLVieweR_proxy
?renderNGLVieweR
runApp()
runApp()
runApp()
？selectInput
?selectInput
NGLVieweR("/home/wt/Ab_Design/test/output/docking/IgLM_seq_0/IgLM_seq_0_rank_1_unrelaxed.pdb") %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(name = "cartoon", colorScheme = "residueindex")
)
NGLVieweR("/home/wt/Ab_Design/test/output/docking/IgLM_seq_0/IgLM_seq_0_rank_1_unrelaxed.pdb") %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(name = "cartoon", colorScheme = "chainname")
)
?addRepresentation
?RepresentationParameters
?renderDT
runApp()
runApp()
runApp()
runApp()
runApp()
31203
31203/60
31203/(60*60)
shiny::runApp()
runApp()
?req
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?updatetextInput
?updateTextInput
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
pdb_file <- "/home/wt/Ab_Design/test/1n8z_B_C.pdb"
hchain = "B"
agchain = "C"
pdbs <- bio3d::read.pdb(pdb_file)
pdbs$atom$chain
unique(pdbs$atom$chain)
(hchain %in% all_chains) & (agchain %in% all_chains)
all_chains <- unique(pdbs$atom$chain)
(hchain %in% all_chains) & (agchain %in% all_chains)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
###展示结果
##解压结果
system(paste0("mkdir /home/wt/Ab_Design/test/output/res/;",
"unzip /home/wt/Ab_Design/test/output/*.zip",
".zip -d /home/wt/Ab_Design/test/output/res"))
###展示结果
##解压结果
system(paste0("mkdir /home/wt/Ab_Design/test/output/res/;",
"unzip /home/wt/Ab_Design/test/output/*.zip",
" -d /home/wt/Ab_Design/test/output/res"))
aff <- read.csv("/home/wt/Ab_Design/test/output/res/*_affinity.csv")
list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "affinity",full.names = T)
aff <- read.csv(list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "affinity",full.names = T))
energy <- read.csv(list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "energy",full.names = T))
list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "energy",full.names = T)
energy <- read.csv(list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "rosetta",full.names = T))
View(energy)
View(aff)
View(aff)
runApp()
##
struc_dt <- read.csv("/home/wt/Ab_Design/test/output/struc_gen_seq.csv")
View(struc_dt)
struc_dt$ID <- sprintf("%04d", struc_dt$ID)
aff$id <- sprintf("%04d", aff$id)
##
struc_dt <- read.csv("/home/wt/Ab_Design/test/output/struc_gen_seq.csv") %>% select(-X)
library(dplyr)
##
struc_dt <- read.csv("/home/wt/Ab_Design/test/output/struc_gen_seq.csv") %>% select(-X)
struc_dt$ID <- sprintf("%04d", struc_dt$ID)
aff <- read.csv(list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "affinity",full.names = T)) %>% select(-X)
aff$id <- sprintf("%04d", aff$id)
energy <- read.csv(list.files("/home/wt/Ab_Design/test/output/res/",
pattern = "rosetta",full.names = T)) %>% select(-X)
energy$id <- sprintf("%04d", energy$id)
struc_dt <- left_join(struc_dt, aff %>% rename(ID=id))
struc_dt <- left_join(struc_dt, energy %>% rename(ID=id))
runApp()
struc_dt$ID <- paste0(struc_dt$ID,"_dldesign_0")
struc_dt <- read.csv("/home/wt/Ab_Design/test/res/abdockgen/struc_gen_seq.csv") %>% select(-X)
struc_dt <- read.csv("/home/wt/Ab_Design/test/res/abopt/output/struc_gen_seq.csv") %>% select(-X)
runApp()
struc_dt$ID <- sprintf("%04d", struc_dt$ID)
struc_dt$ID <- paste0("gen_",struc_dt$ID)
runApp()
runApp()
runApp()
pdbs$atom$chain
pdb_path = "/data/sdd/wt/antibody_design/benchmark/IGLM/her2/fold_dock/out/seq_0/seq_0_rank_1_unrelaxed.pdb"
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(name = "cartoon", colorScheme = "chainname")
)
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(name = "cartoon", colorScheme = "chainname")
) %>% addRepresentation( "surface", param = list(sele = ":C"))
runApp()
runApp()
NULL == "a"
runApp()
?fs::file_move
?fs::file_copy()
runApp()
runApp()
case_when(hchain == "B" ~ "A",)
case_when(hchain == "B" ~ "A",TRUE ~ "C")
runApp()
runApp()
runApp()
runApp()
runApp()
tmp_file_pre = "17555150812865"
paste0("docker exec --user ab abdesigner_last /bin/bash -c 'source /home/ab/miniconda3/bin/activate; cd /home/ab/run/; python run_struc.py -c ",
"/home/ab/run/run_test/output/tmp_struc_",tmp_file_pre,".toml'")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
pdb_path = "~/Ab_Design/test/output/res/Seq_0.pdb"
show_hchain = "h"
show_hchain = "H"
show_agchain = "A"
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = paste0(":",show_hchain), color = "red",
opacity = 1)
) %>%
addRepresentation("surface", param = list(sele = paste0(":",show_agchain),
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon")
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chainname")
)
pdb_path
tt <- bio3d::read.pdb(pdb_path)
tt$atom$chain
tt$atom$chain %>% unique()
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chainname"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chain"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chain"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chainname"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":A", color = "red",
opacity = 1)
) %>%
addRepresentation("surface", param = list(sele = ":H",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":H", color = "red",
opacity = 1)
) %>%
addRepresentation("surface", param = list(sele = ":A",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":H", color = "red",
opacity = 1)
) %>%
addRepresentation("cartoon", param = list(sele = ":A",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":A", color = "red",
opacity = 1)
) %>%
addRepresentation("cartoon", param = list(sele = ":H",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":H", color = "red",
opacity = 1)
) %>%
addRepresentation("cartoon", param = list(sele = ":A",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chainid"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", color = "green",sele = ":H"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", color = "red",sele = ":H"))
pdb_path
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",param = list(name = "cartoon", colorScheme = "chainname"))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("surface",
param = list(sele = ":H", color = "red",
opacity = 1)
) %>%
addRepresentation("cartoon", param = list(sele = ":A",
color = "blue", opacity = 1))
NGLVieweR(pdb_path) %>%
stageParameters(backgroundColor = "white", zoomSpeed = 1) %>%
addRepresentation("cartoon",
param = list(sele = ":H", color = "red",
opacity = 1)
) %>%
addRepresentation("cartoon", param = list(sele = ":A",
color = "blue", opacity = 1))
runApp()
install_github("TebaldiLab/cellmarkeraccordion", dependencies = TRUE)
library(devtools)
install_github("TebaldiLab/cellmarkeraccordion", dependencies = TRUE)
numeric_version(1.5, strict = T)
numeric_version("1.5", strict = T)
?numeric_version
remove.packages("cellmarkeraccordion", lib="~/R/x86_64-pc-linux-gnu-library/4.2")
